{% extends 'layout.html' %}
{% block content %}
<h2> Reportes Gerenciales - SupermercadosApp</h2>
<p>Seleccione el tipo de reporte que desea visualizar:</p>

<select id="tipoReporte">
  <option value="Opciones">Seleccione una opcion</option>
  <option value="productos_mas_vendidos_ciudad">Productos más vendidos por ciudad</option>
  <option value="ticket_promedio">Ticket promedio por sucursal</option>
  <option value="clientes_fidelizados">Top clientes con más puntos</option>
  <option value="canal_ventas">Distribución de ventas (Online vs POS)</option>
  <option value="quiebre_stock">Nivel de quiebre de stock</option>
  <option value="proveedores_confiables">Proveedores más confiables</option>
  <option value="promociones_ventas">Promociones con más ventas</option>
  <option value="evolucion_mensual">Evolución mensual de ventas</option>
  <option value="rentabilidad_sucursales">Rentabilidad por sucursal</option>
  <option value="tasa_devoluciones">Tasa de devoluciones por categoría</option>
</select>

<hr>

<canvas id="graficoVentas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('graficoVentas');
let chart;

function cargarReporte(tipo) {
  if (!tipo) return;
  fetch(`/api/${tipo}`)
    .then(res => res.json())
    .then(data => {
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: tipo === "canal_ventas" ? 'pie' : 
               tipo === "evolucion_mensual" ? 'line' : 'bar',
        data: {
          labels: data.labels,
          datasets: [{
            label: tipo.replaceAll('_', ' ').toUpperCase(),
            data: data.valores,
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    });
}

document.getElementById('tipoReporte').addEventListener('change', (e) => {
  cargarReporte(e.target.value);
});
</script>

{% endblock %}


