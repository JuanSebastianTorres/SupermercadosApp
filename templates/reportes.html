{% extends 'layout.html' %}
{% block content %}
<h2>Reportes Gerenciales</h2>

<hr>

<h3>Ventas por Producto</h3>
<canvas id="graficoVentas" width="400" height="200"></canvas>
<script src="{{ url_for('static', filename='chart.js') }}"></script>
<script>
fetch('/reportes/ventas_por_producto')
  .then(r => r.json())
  .then(data => {
    new Chart(document.getElementById('graficoVentas'), {
      type: 'bar',
      data: {
        labels: data.labels,
        datasets: [{
          label: 'Unidades Vendidas',
          data: data.valores,
          backgroundColor: 'rgba(75, 192, 192, 0.5)'
        }]
      },
      options: { scales: { y: { beginAtZero: true } } }
    });
  });
</script>

<hr>

<h3>Ventas por DÃ­a</h3>
<table border="1" cellpadding="5">
  <tr><th>Fecha</th><th>Total Ventas</th><th># Ventas</th></tr>
  {% for v in ventas_por_dia %}
    <tr><td>{{ v.fecha }}</td><td>${{ v.total_dia }}</td><td>{{ v.num_ventas }}</td></tr>
  {% endfor %}
</table>

<hr>

<h3>Top 5 Clientes</h3>
<table border="1" cellpadding="5">
  <tr><th>Cliente</th><th># Compras</th><th>Total Gastado</th></tr>
  {% for c in top_clientes %}
    <tr><td>{{ c.nombre }} {{ c.apellido }}</td><td>{{ c.num_compras }}</td><td>${{ c.total_gastado }}</td></tr>
  {% endfor %}
</table>

<hr>

<h3>Productos con Bajo Stock</h3>
<table border="1" cellpadding="5">
  <tr><th>Producto</th><th>Stock</th></tr>
  {% for p in productos_bajo_stock %}
    <tr><td>{{ p.nombre }}</td><td>{{ p.stock }}</td></tr>
  {% endfor %}
</table>

<hr>

{% if ventas_sucursal %}
<h3>Ventas por Sucursal</h3>
<table border="1" cellpadding="5">
  <tr><th>Sucursal</th><th>Total Ventas</th></tr>
  {% for s in ventas_sucursal %}
    <tr><td>{{ s.nombre }}</td><td>${{ s.total_ventas }}</td></tr>
  {% endfor %}
</table>
{% endif %}
{% endblock %}

