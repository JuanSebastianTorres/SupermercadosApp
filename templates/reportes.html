{% extends 'layout.html' %}
{% block content %}
<h2>游늵 Reportes Gerenciales - SupermercadosApp</h2>
<p>Seleccione el tipo de reporte que desea visualizar:</p>

<select id="tipoReporte">
  <option value="productos_mas_vendidos_ciudad">Productos m치s vendidos por ciudad</option>
  <option value="ticket_promedio">Ticket promedio por sucursal</option>
  <option value="clientes_fidelizados">Top clientes con m치s puntos</option>
  <option value="canal_ventas">Distribuci칩n de ventas (Online vs POS)</option>
  <option value="quiebre_stock">Nivel de quiebre de stock</option>
  <option value="proveedores_confiables">Proveedores m치s confiables</option>
  <option value="promociones_ventas">Promociones con m치s ventas</option>
  <option value="evolucion_mensual">Evoluci칩n mensual de ventas</option>
  <option value="rentabilidad_sucursales">Rentabilidad por sucursal</option>
  <option value="tasa_devoluciones">Tasa de devoluciones por categor칤a</option>
</select>

<hr>

<canvas id="grafico" width="800" height="400"></canvas>

<script src="{{ url_for('static', filename='chart.js') }}"></script>
<script>
const ctx = document.getElementById('grafico');
let chart;

function cargarReporte(tipo) {
  fetch(`/api/${tipo}`)
    .then(res => res.json())
    .then(data => {
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: tipo === "canal_ventas" ? 'pie' : 
               tipo === "evolucion_mensual" ? 'line' : 'bar',
        data: {
          labels: data.labels,
          datasets: [{
            label: tipo.replaceAll('_', ' ').toUpperCase(),
            data: data.valores,
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    });
}

document.getElementById('tipoReporte').addEventListener('change', (e) => {
  cargarReporte(e.target.value);
});

// cargar uno por defecto al entrar
cargarReporte('productos_mas_vendidos_ciudad');
</script>
{% endblock %}


